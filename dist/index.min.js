(t=>{var e={};function r(a){var s;return(e[a]||(s=e[a]={i:a,l:!1,exports:{}},t[a].call(s.exports,s,s.exports,r),s.l=!0,s)).exports}r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(a,s,function(e){return t[e]}.bind(null,s));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)})([function(t,e,r){var a=r(1);class s{constructor(t){this.arrayType=t,this.bitMask=this.calculateBitMask()}calculateBitMask(){var t={Uint8Array:255,Uint16Array:65535,Uint32Array:4294967295};if(this.arrayType.name in t)return t[this.arrayType.name];throw new Error("Unsupported array type: "+this.arrayType.name)}performDeltaEncoding(t){this.validateInputType(t,"performDeltaEncoding");var e,r=new this.arrayType(t.length),a=0|t.length,s=0;for(r[0]=0|t[0],s=1;(0|s)<(0|a);s=s+1|0)e=t[s]-t[s-1]&this.bitMask,r[s]=0|e;return r}performDeltaDecoding(t){this.validateInputType(t,"performDeltaDecoding");var e,r=new this.arrayType(t.length),a=0|t.length,s=0;for(r[0]=0|t[0],s=1;(0|s)<(0|a);s=s+1|0)e=r[s-1]+t[s]&this.bitMask,r[s]=0|e;return r}validateInputType(t,e){if(!(t instanceof this.arrayType))throw new Error(`Input data type does not match for method ${e}. Expected: `+this.arrayType.name)}}class i{constructor(t){this.bitArray=new Uint8Array(t+7>>3)}setBit(t,e){var r=1<<(t|=0)%8;this.bitArray[t=t/8|0]=(e|=0)?this.bitArray[t]|r:this.bitArray[t]&~r}getBit(t){return this.bitArray[(t|=0)/8|0]&1<<t%8?1:0}}var n=new class{constructor(){this.deltaEncoder8Bit=new s(Uint8Array),this.deltaEncoder16Bit=new s(Uint16Array),this.deltaEncoder32Bit=new s(Uint32Array)}getDeltaEncoder(t){switch(t){case"Uint8Array":case"Int8Array":case"Uint8ClampedArray":return this.deltaEncoder8Bit;case"Uint16Array":case"Int16Array":return this.deltaEncoder16Bit;case"Uint32Array":case"Int32Array":case"Float32Array":case"Float64Array":return this.deltaEncoder32Bit;default:throw new Error("Unknown TypedArray type.")}}compress(t){var e=t.constructor,r=e.name,a=t.length,s=this.getDeltaEncoder(r).performDeltaEncoding(new e(t.buffer)),n=new i(t.length),o=[];let c=s[0];o.push(c);for(let t=1;t<s.length;t++)s[t]===c?n.setBit(t,!0):(o.push(s[t]),c=s[t]);return this.packData(o,n,a,e.BYTES_PER_ELEMENT)}packData(t,e,r,a){a=t.length*a;var s=(e=e.bitArray).length;return(s=new Uint8Array(9+a+s))[0]=this.getDataTypeId(t),s.set(this.convertLengthToBytes(a),1),s.set(this.convertLengthToBytes(r),5),s.set(t,9),s.set(e,9+a),s}convertLengthToBytes(t){return Uint8Array.of(t>>0&255,t>>8&255,t>>16&255,t>>24&255)}getDataTypeId(t){return{Uint8Array:1,Int8Array:2,Uint8ClampedArray:3,Uint16Array:4,Int16Array:5,Uint32Array:6,Int32Array:7,Float32Array:8,Float64Array:9}[t.constructor.name]||0}decompress(t){var e=t[0],r=this.extractLengthFromBytes(t,1),a=this.extractLengthFromBytes(t,5),s=new Uint8Array(t.subarray(9,9+r)),n=(t=new Uint8Array(t.subarray(9+r)),new(r=this.getArrayConstructorByTypeId(e))(s.buffer)),o=new i(8*t.length),c=(o.bitArray=t,new r(a));let h=0;for(let t=0;(0|t)<(0|a);t=t+1|0)o.getBit(t)?c[t]=c[t-1|0]:c[t]=n[h++];return this.getDeltaEncoder(r.name).performDeltaDecoding(c)}extractLengthFromBytes(t,e){return t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24}getArrayConstructorByTypeId(t){return{1:Uint8Array,2:Int8Array,3:Uint8ClampedArray,4:Uint16Array,5:Int16Array,6:Uint32Array,7:Int32Array,8:Float32Array,9:Float64Array}[t]||Uint8Array}},o=class{constructor(t){this._buffers=new WeakMap,this._store={},this._nextId=0,this._compress=t?n.compress.bind(n):function(t){return t},this._decompress=t?n.decompress.bind(n):function(t){return t}}_generateId(){var t=this._nextId;return this._nextId++,t}clear(){this._buffers=new WeakMap,this._store={},this._nextId=0}insert(t,e){if(void 0===e){if(this._buffers.has(t))return this._buffers.get(t);e=this._generateId()}else if(this._store.hasOwnProperty(e))throw new Error(`ID ${e} is already in use.`);return e=parseInt(e),this._buffers.set(t,e),this._store[e]=t,e}retrieve(t){return this._store[parseInt(t)]}retrieveAll(){var t={},e=Object.entries(this._store);for(let s=0;s<e.length;s++){var[r,a]=e[s],a=this._compress(new Uint8Array(a)).buffer;t[parseInt(r)]=a}return t}insertAll(t){var e=Object.entries(t);for(let t=0;t<e.length;t++){var[r,a]=e[t],a=this._decompress(new Uint8Array(a)).buffer;this.insert(a,parseInt(r))}}};r=new class{constructor(){this._packBufferTemp8=new Uint8Array(15e3),this._headerByteLength=0,this._offset=0,this._b64=new a.B64chromium,this._b64Base64ToBytes=this._b64.base64ToBytes.bind(this._b64),this._b64BytesToBase64=this._b64.bytesToBase64.bind(this._b64),this._textDecoder=new TextDecoder,this._textDecoderFunction=this._textDecoder.decode.bind(this._textDecoder),this._textEncoder=new TextEncoder,this._textEncoderFunction=this._textEncoder.encode.bind(this._textEncoder),this._textEncoderIntoFunction=this._textEncoder.encodeInto.bind(this._textEncoder),this.encodeOtherBound=this.encodeOther.bind(this),this.decodeOtherBound=this.decodeOther.bind(this),this.stringifyBound=this._innerStringify.bind(this),this.parseBound=this._innerParse.bind(this),this.use_compressor=!1,this._setEngine()}_setEngine(){this.engine=new class{constructor(t,e,r,a,s,i,n,c,h){this._hasher=new class{constructor(t){this._chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",this._charLookup={};for(let t=0;t<this._chars.length;t++)this._charLookup[this._chars[t]]=t;this._bitPerChar=6,this._accumulatorBitNumber=32,this._outputLength=Math.max(1,Math.min(0|t,this._accumulatorBitNumber/this._bitPerChar|0)),this._primes=Uint32Array.of(2654435761,2246822519,3266489917,668265263),this._values=new Uint32Array(this._primes.length+2),this.imul=Math.imul,this.rotl=function(t,e){return(t>>>=0)<<(e&=31)|t>>>32-e}}get outputLength(){return this._outputLength}get chars(){return this._chars}get finalValue(){return this._values[4]}set finalValue(t){return this._values[4]=(0|t)>>>0}get primes(){return this._primes}get values(){return this._values}get accumulator(){return this._values}get charLookup(){return this._charLookup}getCharValue(t){return 63&this.charLookup[t]}aggregateCharValue(t,e,r,a){return t<<18|e<<12|r<<6|a}getCharByOffset(t){return this.chars[63&t]}hash(t){this.values.fill(0);for(var e=0,r=0,a=t.length,s=a>>2>>2;e<s;r=++e<<4)this.accumulator[0]=this.accumulator[0]+this.imul(this.aggregateCharValue(this.getCharValue(t[r]),this.getCharValue(t[r+1|0]),this.getCharValue(t[r+2|0]),this.getCharValue(t[r+3|0])),this.primes[0]),this.accumulator[1]=this.accumulator[1]+this.imul(this.aggregateCharValue(this.getCharValue(t[r+4|0]),this.getCharValue(t[r+5|0]),this.getCharValue(t[r+6|0]),this.getCharValue(t[r+7|0])),this.primes[1]),this.accumulator[2]=this.accumulator[2]+this.imul(this.aggregateCharValue(this.getCharValue(t[r+8|0]),this.getCharValue(t[r+9|0]),this.getCharValue(t[r+10|0]),this.getCharValue(t[r+11|0])),this.primes[2]),this.accumulator[3]=this.accumulator[3]+this.imul(this.aggregateCharValue(this.getCharValue(t[r+12|0]),this.getCharValue(t[r+13|0]),this.getCharValue(t[r+14|0]),this.getCharValue(t[r+15|0])),this.primes[3]);for(e<<=2;(0|e)<(0|a);r=(e=(e+1|0)>>>0)<<2)this.accumulator[3&e]=this.accumulator[3&e]+this.imul(this.aggregateCharValue(this.getCharValue(t[r])||0,this.getCharValue(t[r+1|0])||0,this.getCharValue(t[r+2|0])||0,this.getCharValue(t[r+3|0]))||0,this.primes[3&e]);this.finalValue=this.rotl(this.accumulator[0],1)+this.rotl(this.accumulator[1],7)+this.rotl(this.accumulator[2],12)+this.rotl(this.accumulator[3],18)>>>0;for(var i,n=0,o=new Array(this.outputLength);n<this.outputLength;n++)i=63&this.finalValue,o[n]=this.getCharByOffset(i),this.finalValue=(this.finalValue-i)/64>>>0;return o.join("")}}(1),this.hashThis=a||this._hasher.hash.bind(this._hasher),this.base=t||"data:joyson/",this.shortBase=e||"d:j/",this.baseLength=this.base.length,this.shortBaseLength=this.shortBase.length,this.encapsulate=r||function(t){return JSON.stringify(t)},this.encodeObjectOut=s||function(t){return t},this.decodeObjectOut=i||function(t){return t},this.stringifyOut=n||JSON.stringify,this.parseOut=c||JSON.parse,this._initializeErrorConstructors(),this.arrayBufferIDManager=new o(h),this._initializeBufferConstructors(),this._initializeDynamicTypes(["object","number","bigint","map","set","date","string","error","regexp","buffer","boolean","static"])}_initializeDynamicTypes(t){this.dynamicValues={},this.dynamicValuesIdKey={};for(var e=0;e<t.length;e++){var r=t[e];this.dynamicValues[r]={},this.dynamicValues[r].name=r,this.dynamicValues[r].str=this.base+this.dynamicValues[r].name+";",this.dynamicValues[r].id=this.hashThis(this.dynamicValues[r].name),this.dynamicValues[r].shortStr=this.shortBase+this.dynamicValues[r].id+";",this.dynamicValues[r].strCode=new Uint8Array(this.dynamicValues[r].str.split("").map((function(t){return t.charCodeAt(0)}))),this.dynamicValues[r].shortStrCode=new Uint8Array(this.dynamicValues[r].shortStr.split("").map((function(t){return t.charCodeAt(0)}))),this.dynamicValues[r].strLen=this.dynamicValues[r].str.length,this.dynamicValues[r].shortStrLen=this.dynamicValues[r].shortStr.length,this.dynamicValuesIdKey[this.dynamicValues[r].id]=this.dynamicValues[r].name}}_initializeErrorConstructors(){this.errorConstructors={Error:Error,TypeError:TypeError,SyntaxError:SyntaxError,ReferenceError:ReferenceError,RangeError:RangeError,EvalError:EvalError,URIError:URIError,DOMException:DOMException}}_initializeBufferConstructors(){this.bufferConstructors={ArrayBuffer:ArrayBuffer,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int8Array:Int8Array,Uint16Array:Uint16Array,Int16Array:Int16Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Float32Array:Float32Array,Float64Array:Float64Array}}clear(){this.arrayBufferIDManager.clear()}getAllArrayBuffer(){var t=this.arrayBufferIDManager.retrieveAll();return this.clear(),t}setAllArrayBuffer(t){this.clear(),this.arrayBufferIDManager.insertAll(t)}_isNotNumber(t){return isNaN(t)}_isNotFiniteNumber(t){return!isFinite(t)}_isNotObject(t){return null===t}_isNotString(t){return t.includes("\0")}_isError(t){return void 0!==t.name&&t.name in this.errorConstructors}_isBuffer(t){return(t instanceof ArrayBuffer||"object"==typeof t.buffer)&&(t.constructor||{}).name in this.bufferConstructors}_mustDecodeOfType(t){if("string"==typeof t){if(t.startsWith(this.shortBase))return 2;if(t.startsWith(this.base))return 1}return 0}_dataTypeNameFromKey(t){return this.dynamicValuesIdKey[t]}_decode(t,e){var r=t.slice(e?this.shortBaseLength:this.baseLength).split(";"),a=r[0],s=r[1];switch(e?this._dataTypeNameFromKey(a):a){case"static":return this.decodeStatic(s);case"number":return this.decodeSpecialNumber(s);case"bigint":return this.decodeBigNumber(s);case"string":return this.decodeSpecialString(s);case"boolean":return this.decodeBoolean(s);case"map":return this.decodeMap(s);case"set":return this.decodeSet(s);case"date":return this.decodeDate(s);case"regexp":return this.decodeRegexp(s);case"error":return this.decodeError(s);case"buffer":return this.decodeBuffer(s);case"object":return this.decodeSpecialObject(s);default:return this.decodeObjectOut(t,e)}}decode(t,e){switch(this._mustDecodeOfType(t)){case 0:return"object"==typeof t?this.decodeObjectOut(t,e):t;case 1:return this._decode(t,!1);case 2:return this._decode(t,!0)}}decodeStatic(t){switch(t){case"nan":return NaN;case"null":return null;case"undefined":return}}decodeSpecialNumber(t){switch(t){case"nan":return NaN;case"infinity":return 1/0;case"-infinity":return-1/0;case"epsilon":return Number.EPSILON;case"-epsilon":return-Number.EPSILON;case"-0":return parseInt("-0");default:return Number(t)}}decodeBigNumber(t){return BigInt(t)}decodeSpecialString(t){return atob(t)}decodeBoolean(t){return"true"===t}decodeMap(t){return t=atob(t),t=this.parseOut(t),new Map(t)}decodeSet(t){return t=atob(t),t=this.parseOut(t),new Set(t)}decodeDate(t){return new Date(t)||new Date(NaN)}decodeRegexp(t){t=t.split(":");var e=atob(t[0]);t=atob(t[1]);return new RegExp(e,t)}decodeError(t){t=t.split(":");var e=atob(t[0]);t=atob(t[1]);return new this.errorConstructors[e](t)}decodeBuffer(t){var e="ArrayBuffer"===(r=(t=t.split(":"))[0]),r=this.bufferConstructors[r],a=parseInt(t[1],16),s=parseInt(t[2],16);t=parseInt(t[3],16),t=this.arrayBufferIDManager.retrieve(t);return e?t:new r(t,a,s)}decodeSpecialObject(t){return t=atob(t),t=this.parseOut(t),Object(t)}_encodeFinal(t,e,r){return r?this.dynamicValues[t].shortStr+e:this.encapsulate(this.dynamicValues[t].str+e)}encode(t,e){switch(typeof t){case"undefined":return this.encodeStatic(t,e);case"number":return this._isNotNumber(t)?this.encodeStatic(t,e):this.encodeNumber(t,e);case"bigint":return this.encodeBigNumber(t,e);case"string":return this._isNotString(t)?this.encodeSpecialString(t,e):this.encodeString(t,e);case"boolean":return this.encodeBoolean(t,e);case"object":return this._isNotObject(t)?this.encodeStatic(t,e):"function"==typeof t.get?this.encodeMap(t,e):"function"==typeof t.delete?this.encodeSet(t,e):"function"==typeof t.toISOString?this.encodeDate(t,e):"function"==typeof t.exec?this.encodeRegexp(t,e):t!==t.valueOf()?this.encodeSpecialObject(t,e):this._isError(t)?this.encodeError(t,e):this._isBuffer(t)?this.encodeBuffer(t,e):this.encodeObject(t,e)}}encodeStatic(t,e){var r;switch(typeof t){case"number":r="nan";break;case"object":r="null";break;case"undefined":r="undefined"}return this._encodeFinal("static",r,e)}encodeNumber(t,e){var r;switch(t){case NaN:r="nan";break;case 1/0:r="infinity";break;case-1/0:r="-infinity";break;case Number.EPSILON:r="epsilon";break;case-Number.EPSILON:r="-epsilon";break;default:if("-0"===Number(t).toLocaleString())r="-0";else{if(!this._isNotFiniteNumber(t))return e?t:""+t;r=t}}return this._encodeFinal("number",r,e)}encodeBigNumber(t,e){return t=t.toString(),this._encodeFinal("bigint",t,e)}encodeSpecialString(t,e){return t=btoa(t),this._encodeFinal("string",t,e)}encodeString(t,e){return e?""+t:this.encapsulate(t)}encodeBoolean(t,e){return this._encodeFinal("boolean",t?"true":"false",e)}encodeMap(t,e){return t=Object.entries(Object.fromEntries(t)),t=this.stringifyOut(t),t=btoa(t),this._encodeFinal("map",t,e)}encodeSet(t,e){return t=Array.from(t),t=this.stringifyOut(t),t=btoa(t),this._encodeFinal("set",t,e)}encodeDate(t,e){return t=t.toISOString(),this._encodeFinal("date",t,e)}encodeRegexp(t,e){return t=[btoa(t.source),btoa(t.flags)],this._encodeFinal("regexp",t.join(":"),e)}encodeSpecialObject(t,e){return t=this.stringifyOut(t.valueOf()),t=btoa(t),this._encodeFinal("object",t,e)}encodeError(t,e){return t=[btoa(t.name),btoa(t.message)],this._encodeFinal("error",t.join(":"),e)}encodeBuffer(t,e){var r=(i=void 0===t.buffer)?"ArrayBuffer":t.constructor.name,a=t.byteOffset,s=i?t.byteLength:t.length,i=i?t:t.buffer;t=this.arrayBufferIDManager.insert(i),i=[r,parseInt(a).toString(16),parseInt(s).toString(16),parseInt(t).toString(16)];return this._encodeFinal("buffer",i.join(":"),e)}encodeObject(t,e){return this.encodeObjectOut(t,e)}}(void 0,void 0,void 0,void 0,this.encodeOtherBound,this.decodeOtherBound,this.stringifyBound,this.parseBound,this.use_compressor)}get compress(){return this.use_compressor}set compress(t){this.use_compressor=Boolean(t),this._setEngine()}_getComparator(){return function(t){return function(e){return function(r,a){return r={key:r,value:e[r]},t(r,{key:a,value:e[a]})}}}}_stringifyObject(t){if(Array.isArray(t)){for(var e=0,r=t.length,a=((s=Object.keys(t)).length,new Array(r));(0|e)<(0|r);e=(e+1|0)>>>0)a[e]=this.engine.encode(t[e],!1);return"["+a.join(",")+"]"}for(var s,i,n=this._getComparator(),o="",c=(e=0,r=0|(s=Object.keys(t).sort(n&&n(t))).length,"");(0|e)<(0|r);e=(e+1|0)>>>0)if(o=s[e]+"",i=this.engine.encode(t[o],!1))switch(0<(0|c.length)&&(c+=","),0|(0===o.length||o.includes("\0")||o.startsWith("$"))){case 0:c+=this.engine.encode(o,!1)+":"+i;break;case 1:c+='"$'+btoa("$"+o)+'":'+i}return"{"+c+"}"}encodeOther(t,e){return e?this._packObject(t):this._stringifyObject(t)}decodeOther(t,e){return e?this._unpackObject(t):this._parseObject(t)}_stringify(t,e){var r={};if(r.header=this.engine.encode(t,!1),!e){var a,s=this.engine.getAllArrayBuffer();for(a in r.buffers={},s)r.buffers[a]=this._b64BytesToBase64(new Uint8Array(s[a]))}return JSON.stringify(r)}stringify(t){return this._stringify(t,!1)}_innerStringify(t){return this._stringify(t,!0)}_parseObject(t){if(Array.isArray(t)){for(var e=[],r=0,a=t.length;(0|r)<(0|a);r=(r+1|0)>>>0)e.push(this.engine.decode(t[r]));return e}var s,i,n={},o=Object.keys(t),c="";for(r=0,a=0|o.length;(0|r)<(0|a);r=(r+1|0)>>>0)switch(c=o[r],s=this._keyMustDecode(c),i=this.engine.decode(t[c]),0|s){case 0:n[c]=i;break;case 1:n[atob(c.slice(1)).slice(1)]=i}return n}_parse(t,e){var r,a;t=JSON.parse(t);return e||(r=this._b64Base64ToBytes,a={},Object.entries(t.buffers).forEach((function(t){var e=t[0];a[e]=r(t[1]).buffer})),this.engine.setAllArrayBuffer(a)),this.engine.decode(JSON.parse(t.header))}parse(t){return this._parse(t,!1)}_innerParse(t){return this._parse(t,!0)}_packObject(t){if(Array.isArray(t)){for(var e=[],r=0,a=t.length;(0|r)<(0|a);r=(r+1|0)>>>0)e.push(this.engine.encode(t[r],!0));return e}var s,i={},n=Object.keys(t),o="";for(r=0,a=0|n.length;(0|r)<(0|a);r=(r+1|0)>>>0)if(o=n[r]+"",s=this.engine.encode(t[o],!0))switch(0|(""===o||o.includes("\0")||o.startsWith("$"))){case 0:i[this.engine.encode(o,!0)]=s;break;case 1:i["$"+btoa("$"+o)]=s}return i}pack(t){t=JSON.stringify(this.engine.encode(t,!0));var e=this.engine.getAllArrayBuffer(),r=0,a=Object.keys(e).length;for(n in e)r+=e[n].byteLength;var s=2*t.length+5,i=s+r+4;if((i=(this._packBufferTemp8.length<i&&(this._packBufferTemp8=new Uint8Array(i)),this._textEncoderIntoFunction(t,this._packBufferTemp8.subarray(4,4+s)))).written>s)throw new Error("Header in json is too fat!");t=i.written;var n,o=(this._packBufferTemp8[0]=t>>0&255,this._packBufferTemp8[1]=t>>8&255,this._packBufferTemp8[2]=t>>16&255,this._packBufferTemp8[3]=t>>24&255,t);r=4;for(n in this._packBufferTemp8[o+r]=a>>0&255,this._packBufferTemp8[o+r+1]=a>>8&255,this._packBufferTemp8[o+r+2]=a>>16&255,this._packBufferTemp8[o+r+3]=a>>24&255,r+=4,e){var c=e[n],h=c.byteLength;this._packBufferTemp8[o+r]=h>>0&255,this._packBufferTemp8[o+r+1]=h>>8&255,this._packBufferTemp8[o+r+2]=h>>16&255,this._packBufferTemp8[o+r+3]=h>>24&255,r+=4,this._packBufferTemp8.set(new Uint8Array(c),o+r),r+=h}return this._packBufferTemp8.slice(0,o+r)}_keyMustDecode(t){return t.startsWith("$")}_unpackObject(t){if(Array.isArray(t)){for(var e=[],r=0,a=t.length;(0|r)<(0|a);r=(r+1|0)>>>0)e.push(this.engine.decode(t[r],!0));return e}var s,i,n={},o=Object.keys(t),c="";for(r=0,a=0|o.length;(0|r)<(0|a);r=(r+1|0)>>>0)switch(c=o[r],s=this._keyMustDecode(c),i=this.engine.decode(t[c],!0),0|s){case 0:n[c]=i;break;case 1:n[atob(c.slice(1)).slice(1)]=i}return n}unpack(t){for(var e=4+(t[0]<<0|t[1]<<8|t[2]<<16|t[3]<<24),r=4+e,a=JSON.parse(this._textDecoderFunction(t.subarray(4,e))),s=t[e]<<0|t[1+e]<<8|t[2+e]<<16|t[3+e]<<24,i={},n=r,o=0;o<s;o++){var c=t[n]<<0|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24;n+=4,i[o]=t.buffer.slice(n,n+c),n+=c}return this.engine.setAllArrayBuffer(i),this.engine.decode(a,!0)}},e.a=r},function(t,e,r){var a=(()=>{var t=new ArrayBuffer(2560),e=new Uint8Array(t,0,256),r=new Uint8Array(t,256,256),a=new Uint32Array(t,512,128),s=new Uint32Array(t,1024,128),i=new Uint32Array(t,1536,128),n=new Uint32Array(t,2048,128);e.set(Uint8Array.from("AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHHIIIIJJJJKKKKLLLLMMMMNNNNOOOOPPPPQQQQRRRRSSSSTTTTUUUUVVVVWWWWXXXXYYYYZZZZaaaabbbbccccddddeeeeffffgggghhhhiiiijjjjkkkkllllmmmmnnnnooooppppqqqqrrrrssssttttuuuuvvvvwwwwxxxxyyyyzzzz0000111122223333444455556666777788889999++++////".split("").map((function(t){return 255&t.charCodeAt(0)})))),r.set(Uint8Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").map((function(t){return 255&t.charCodeAt(0)})))),a.set(new Uint32Array(128).fill(33554431)),s.set(new Uint32Array(128).fill(33554431)),i.set(new Uint32Array(128).fill(33554431)),n.set(new Uint32Array(128).fill(33554431)),Object.entries({43:[248,57347,8392448,4063232],47:[252,61443,12586752,4128768],48:[208,16387,3328,3407872],49:[212,20483,4197632,3473408],50:[216,24579,8391936,3538944],51:[220,28675,12586240,3604480],52:[224,32771,3584,3670016],53:[228,36867,4197888,3735552],54:[232,40963,8392192,3801088],55:[236,45059,12586496,3866624],56:[240,49155,3840,3932160],57:[244,53251,4198144,3997696],65:[0,0,0,0],66:[4,4096,4194304,65536],67:[8,8192,8388608,131072],68:[12,12288,12582912,196608],69:[16,16384,256,262144],70:[20,20480,4194560,327680],71:[24,24576,8388864,393216],72:[28,28672,12583168,458752],73:[32,32768,512,524288],74:[36,36864,4194816,589824],75:[40,40960,8389120,655360],76:[44,45056,12583424,720896],77:[48,49152,768,786432],78:[52,53248,4195072,851968],79:[56,57344,8389376,917504],80:[60,61440,12583680,983040],81:[64,1,1024,1048576],82:[68,4097,4195328,1114112],83:[72,8193,8389632,1179648],84:[76,12289,12583936,1245184],85:[80,16385,1280,1310720],86:[84,20481,4195584,1376256],87:[88,24577,8389888,1441792],88:[92,28673,12584192,1507328],89:[96,32769,1536,1572864],90:[100,36865,4195840,1638400],97:[104,40961,8390144,1703936],98:[108,45057,12584448,1769472],99:[112,49153,1792,1835008],100:[116,53249,4196096,1900544],101:[120,57345,8390400,1966080],102:[124,61441,12584704,2031616],103:[128,2,2048,2097152],104:[132,4098,4196352,2162688],105:[136,8194,8390656,2228224],106:[140,12290,12584960,2293760],107:[144,16386,2304,2359296],108:[148,20482,4196608,2424832],109:[152,24578,8390912,2490368],110:[156,28674,12585216,2555904],111:[160,32770,2560,2621440],112:[164,36866,4196864,2686976],113:[168,40962,8391168,2752512],114:[172,45058,12585472,2818048],115:[176,49154,2816,2883584],116:[180,53250,4197120,2949120],117:[184,57346,8391424,3014656],118:[188,61442,12585728,3080192],119:[192,3,3072,3145728],120:[196,4099,4197376,3211264],121:[200,8195,8391680,3276800],122:[204,12291,12585984,3342336]}).forEach((function(t){a[parseInt(t[0])]=4294967295&t[1][0],s[parseInt(t[0])]=4294967295&t[1][1],i[parseInt(t[0])]=4294967295&t[1][2],n[parseInt(t[0])]=4294967295&t[1][3]}));class o{constructor(){this._CHNK_L_=Math.pow(108,2)/2|0,this._CHNK_L_STR_=3*this._CHNK_L_|0,this._CHNK_L_BUFF_=4*this._CHNK_L_|0,this._PAD_C_=255&"=".charCodeAt(0),this._E0_=e.slice(0,e.length),this._E1_=r.slice(0,r.length),this._D0_=a.slice(0,a.length),this._D1_=s.slice(0,s.length),this._D2_=i.slice(0,i.length),this._D3_=n.slice(0,n.length),this._AB_=new ArrayBuffer(this._CHNK_L_BUFF_+4|0),this._u32aT_=new Uint32Array(this._AB_,0,1),this._u8aT_=new Uint8Array(this._AB_,0,3),this._T_=new Uint8Array(this._AB_,4,0|this._CHNK_L_BUFF_)}get PAD_C(){return 255&this._PAD_C_}get CHNK_L_STR(){return 0|this._CHNK_L_STR_}get u32aT0(){return this._u32aT_[0]}set u32aT0(t){this._u32aT_[0]=(0|t)>>>0}get u8aTa(){return this._u8aT_[0]}get u8aTb(){return this._u8aT_[1]}get u8aTc(){return this._u8aT_[2]}_base64_decode_u32ax1(t,e){this.u32aT0=this._D0_[255&t.charCodeAt(e=(0|e)>>>0)]|this._D1_[255&t.charCodeAt(e+1|0)]|this._D2_[255&t.charCodeAt(e+2|0)]|this._D3_[255&t.charCodeAt(e+3|0)]}_base64_encode_u8ax4(t,e,r){this._T_[0|(e=(0|e)>>>0)]=this._E0_[t[(0|(r=(0|r)>>>0))>>>0]],this._T_[e+1|0]=this._E1_[(3&t[(0|r)>>>0])<<4|t[(r+1|0)>>>0]>>4&15],this._T_[e+2|0]=this._E1_[(15&t[(r+1|0)>>>0])<<2|t[(r+2|0)>>>0]>>6&3],this._T_[e+3|0]=this._E1_[t[(r+2|0)>>>0]]}_base64_encode_final(t,e,r,a){switch(a=(0|a)>>>0,((r=(0|r)>>>0)-(e=(0|e)>>>0)|0)>>>0){case 1:return this._T_[0|a]=this._E0_[t[(0|e)>>>0]],this._T_[a+1|0]=this._E1_[(3&t[(0|e)>>>0])<<4|t[(e+1|0)>>>0]>>4&15],this._T_[a+2|0]=this._PAD_C_,this._T_[a+3|0]=this._PAD_C_,this._T_.subarray(0,0|(a=a+4|0));case 2:return this._T_[0|a]=this._E0_[t[(0|e)>>>0]],this._T_[a+1|0]=this._E1_[(3&t[(0|e)>>>0])<<4|t[(e+1|0)>>>0]>>4&15],this._T_[a+2|0]=this._E1_[(15&t[(e+1|0)>>>0])<<2|t[(e+2|0)>>>0]>>6&3],this._T_[a+3|0]=this._PAD_C_,this._T_.subarray(0,0|(a=a+4|0));case 0:return this._T_.subarray(0,0|a);default:return this._T_}}_base64_decode_final(t,e,r,a,s){switch(r=(0|r)>>>0,a=(0|a)>>>0,0|(s=(0|s)>>>0)){case 0:return this.u32aT0=(this._D0_[e.charCodeAt(0|r)]|this._D1_[e.charCodeAt(r+1|0)]|this._D2_[e.charCodeAt(r+2|0)]|this._D3_[e.charCodeAt(r+3|0)]|0)>>>0,t[0|a]=255&this.u32aT0,t[a+1|0]=this.u32aT0>>8&255,t[a+2|0]=this.u32aT0>>16&255,a+3|0;case 1:return this.u32aT0=(0|this._D0_[e.charCodeAt(0|r)])>>>0,t[0|a]=255&this.u32aT0,a+1|0;case 2:return this.u32aT0=(this._D0_[e.charCodeAt(0|r)]|this._D1_[e.charCodeAt(r+1|0)]|0)>>>0,t[0|a]=255&this.u32aT0,a+1|0;default:return this.u32aT0=(this._D0_[e.charCodeAt(0|r)]|this._D1_[e.charCodeAt(r+1|0)]|this._D2_[e.charCodeAt(r+2|0)]|0)>>>0,t[0|a]=255&this.u32aT0,t[a+1|0]=this.u32aT0>>8&255,a+2|0}}_base64_store_u8ax3(t,e){t[e=(0|e)>>>0]=this.u8aTa,t[e+1|0]=this.u8aTb,t[e+2|0]=this.u8aTc}get_max_round_str(t){return 0|Math.ceil(t/this.CHNK_L_STR)}base64_encode(t,e){var r=0|t.length,a=(e|=0)*this.CHNK_L_STR|0,s=0,i=Math.min(a+this.CHNK_L_STR|0,0|r)-2|0;if(0<(0|i))for(;(0|a)<(0|i);a=(a+3|0)>>>0,s=s+4|0)this._base64_encode_u8ax4(t,s,a);return o.encodeChars_(this._base64_encode_final(t,a,r,s))}bytesToBase64(t){for(var e="",r=0,a=this.get_max_round_str(t.length);(0|r)<(0|a);r=(r+1|0)>>>0)e+=this.base64_encode(t,0|r);return e}base64ToBytes(t){var e,r,a=0|t.length,s=0,i=0,n=0;if(0==(0|a))return new Uint8Array(0);for(t.charCodeAt(a-1|0)===this.PAD_C&&(n=n+1|0,t.charCodeAt((a=a-1|0)-1|0)===this.PAD_C)&&(a=a-1|0,n=n+1|0),e=new Uint8Array(t.length/4*3-n),r=0==(0|(n=3&a))?(a>>>2)-1|0:a>>>2;(0|s)<(0|r);s=(s+1|0)>>>0)this._base64_decode_u32ax1(t,s<<2),this._base64_store_u8ax3(e,i),i=i+3|0;return this._base64_decode_final(e,t,s<<=2,i,n),e}}return o.charCode_=function(t){return 255&t.charCodeAt(0)},o.charCodeAt_=function(t,e){return 255&t.charCodeAt(0|e)},o.encodeChars_=function(t){return 0<(0|t.length)?String.fromCharCode.apply(null,t):""},o})();t.exports={B64chromium:a}},function(t,e,r){r.r(e),function(t){var e=r(0);function a(t,e){var r,a=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)),a}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach((function(e){var a,s;a=t,s=r[e=e],(e=(t=>"symbol"==typeof(t=((t,e)=>{if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return String(t);if("object"!=typeof(r=r.call(t,e)))return r;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"))?t:t+"")(e))in a?Object.defineProperty(a,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[e]=s})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}class i{static async compress(t){t="string"==typeof t?(new TextEncoder).encode(t):t;var e=new CompressionStream("deflate"),r=e.writable.getWriter();return r.write(t),r.close(),this._streamToUint8Array(e.readable)}static async decompress(t){var e=new DecompressionStream("deflate"),r=e.writable.getWriter();return r.write(t),r.close(),this._streamToUint8Array(e.readable)}static async _streamToUint8Array(t){var e=t.getReader(),r=[];let a=0;for(;;){var{value:s,done:i}=await e.read();if(i)break;r.push(s),a+=s.length}var n,o=new Uint8Array(a);let c=0;for(n of r)o.set(n,c),c+=n.length;return o}}class n{static async encrypt(t,e){var r=crypto.getRandomValues(new Uint8Array(16)),a=(e=await this._deriveKey(e,r),crypto.getRandomValues(new Uint8Array(12))),s=await this._generateChecksum(t);t=this._combineDataAndChecksum(t,s),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},e,t);return this._wrapIntoUint8Array(r,a,new Uint8Array(s))}static async decrypt(t,e){var{salt:t,iv:r,encryptedData:a}=this._unwrapUint8Array(t),r=(e=await this._deriveKey(e,t),t=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},e,a),new Uint8Array(t)),{data:e,checksum:a}=this._separateDataAndChecksum(r);t=await this._generateChecksum(e);if(this._verifyChecksum(t,a))return e;throw new Error("Data integrity check failed. The data has been tampered with.")}static async _deriveKey(t,e){var r=new TextEncoder;r=await crypto.subtle.importKey("raw",r.encode(t),{name:"PBKDF2"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:15e4,hash:"SHA-512"},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}static async _generateChecksum(t){return new Uint8Array(await crypto.subtle.digest("SHA-256",t))}static _verifyChecksum(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}static _combineDataAndChecksum(t,e){var r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}static _separateDataAndChecksum(t){var e=t.length-32;return{data:t.slice(0,e),checksum:t.slice(e)}}static _wrapIntoUint8Array(t,e,r){var a=new Uint8Array(t.length+e.length+r.length);return a.set(t,0),a.set(e,t.length),a.set(r,t.length+e.length),a}static _unwrapUint8Array(t){return{salt:t.slice(0,16),iv:t.slice(16,28),encryptedData:t.slice(28)}}}class o{static openDatabase(t,e=null,r=null){return new Promise((a,s)=>{let i;(i=e?indexedDB.open(t,e):indexedDB.open(t)).onupgradeneeded=e=>{var a=e.target.result,s=e.oldVersion;e=e.newVersion;console.log(`Upgrading database "${t}" from version ${s} to `+e),r&&r(a,s,e)},i.onsuccess=e=>{(e=e.target.result).onclose=()=>{console.log(`Database "${t}" connection is closing.`)},a(e)},i.onerror=e=>{s(new Error(`Failed to open database "${t}": `+e.target.error.message))}})}static async performTransaction(t,e,r,a,s=3){try{if(!t)throw new Error("Database connection is not available.");let s=t.transaction(Array.isArray(e)?e:[e],r),i=await a(...Array.isArray(e)?e.map(t=>s.objectStore(t)):[s.objectStore(e)]);return new Promise((t,e)=>{s.oncomplete=()=>t(i),s.onerror=()=>e(new Error("Transaction failed: "+(s.error?s.error.message:"unknown error")))})}catch(i){if(0<s)return console.warn(`Transaction failed, retrying... (${s} attempts left): `+i.message),this.performTransaction(t,e,r,a,s-1);throw new Error("Transaction ultimately failed after retries: "+i.message)}}static add(t,e){return new Promise((r,a)=>{var s=t.add(e);s.onsuccess=()=>r(),s.onerror=t=>a("Failed to insert record: "+t.target.error.message)})}static put(t,e){return new Promise((r,a)=>{var s=t.put(e);s.onsuccess=()=>r(),s.onerror=t=>a("Failed to put record: "+t.target.error.message)})}static delete(t,e){return new Promise((r,a)=>{var s=t.delete(e);s.onsuccess=()=>r(),s.onerror=t=>a("Failed to delete record: "+t.target.error.message)})}static get(t,e){return new Promise((r,a)=>{var s=t.get(e);s.onsuccess=t=>r(t.target.result),s.onerror=t=>a(`Failed to retrieve record with key ${e}: `+t.target.error.message)})}static getAll(t){return new Promise((e,r)=>{var a=t.getAll();a.onsuccess=t=>e(t.target.result),a.onerror=t=>r("Failed to retrieve records: "+t.target.error.message)})}static count(t){return new Promise((e,r)=>{var a=t.count();a.onsuccess=t=>e(t.target.result),a.onerror=t=>r("Failed to count records: "+t.target.error.message)})}static clear(t){return new Promise((e,r)=>{var a=t.clear();a.onsuccess=()=>e(),a.onerror=t=>r("Failed to clear store: "+t.target.error.message)})}static deleteDatabase(t){return new Promise((e,r)=>{var a=indexedDB.deleteDatabase(t);a.onsuccess=()=>e(),a.onerror=t=>r("Failed to delete database: "+t.target.error.message)})}static iterateCursor(t,e){return new Promise((r,a)=>{var s=t.openCursor();s.onsuccess=t=>{(t=t.target.result)?(e(t.value,t.key),t.continue()):r()},s.onerror=t=>a("Cursor iteration failed: "+t.target.error.message)})}}class c{static getItem(t){return(t=localStorage.getItem(t))?e.a.parse(t):null}static setItem(t,r){localStorage.setItem(t,e.a.stringify(r))}static removeItem(t){localStorage.removeItem(t)}static clear(){localStorage.clear()}}class h{constructor(t){this._dbName=t,this._metadataKey=`lacertadb_${this._dbName}_metadata`,this._collections=new Map,this._metadata=this._loadMetadata()}_loadMetadata(){var t=c.getItem(this.metadataKey);if(t){for(var e in t.collections){var r=t.collections[e];r=new d(e,this,r);this.collections.set(e,r)}this.data=t}else this.data={name:this._dbName,collections:{},totalSizeKB:0,totalLength:0,modifiedAt:Date.now()};return this._metadata}get data(){return this._metadata}set data(t){this._metadata=t}get name(){return this.data.name}get metadataKey(){return this._metadataKey}get collections(){return this._collections}set collections(t){this._collections=t}get totalSizeKB(){return this.data.totalSizeKB}get totalLength(){return this.data.totalLength}get modifiedAt(){return this.data.modifiedAt}getCollectionMetadata(t){var e;return this.collections.has(t)||(e=new d(t,this),this.collections.set(t,e),this.data.collections[t]=e.getRawMetadata(),this.data.modifiedAt=Date.now()),this.collections.get(t)}removeCollectionMetadata(t){var e=this.collections.get(t);e&&(this.data.totalSizeKB-=e.sizeKB,this.data.totalLength-=e.length,this.collections.delete(t),delete this.data.collections[t],this.data.modifiedAt=Date.now())}adjustTotals(t,e){this.data.totalSizeKB+=t,this.data.totalLength+=e,this.data.modifiedAt=Date.now()}getCollectionNames(){return Array.from(this.collections.keys())}getRawMetadata(){for(var[t,e]of this._collections.entries())this.data.collections[t]=e.getRawMetadata();return this.data}setRawMetadata(t){for(var e in this._metadata=t,this._collections.clear(),t.collections){var r=t.collections[e];r=new d(e,this,r);this._collections.set(e,r)}}get dbName(){return this._dbName}get key(){return this._metadataKey}saveMetadata(){c.setItem(this.key,this.getRawMetadata())}}class d{constructor(t,e,r=null){this._collectionName=t,this._databaseMetadata=e,r?this._metadata=r:(this._metadata={name:t,sizeKB:0,length:0,createdAt:Date.now(),modifiedAt:Date.now(),documentSizes:{},documentModifiedAt:{},documentPermanent:{}},this._databaseMetadata.data.collections[t]=this._metadata,this._databaseMetadata.data.modifiedAt=Date.now())}get name(){return this._collectionName}get keys(){return Object.keys(this.documentSizes)}get collectionName(){return this.name}get sizeKB(){return this._metadata.sizeKB}get length(){return this._metadata.length}get modifiedAt(){return this._metadata.modifiedAt}get metadata(){return this._metadata}set metadata(t){return this._metadata=t}get data(){return this.metadata}set data(t){this.metadata=t}get databaseMetadata(){return this._databaseMetadata}set databaseMetadata(t){this._databaseMetadata=t}get documentSizes(){return this.metadata.documentSizes}get documentModifiedAt(){return this.metadata.documentModifiedAt}get documentPermanent(){return this.metadata.documentSizes}set documentSizes(t){this.metadata.documentSizes=t}set documentModifiedAt(t){this.metadata.documentModifiedAt=t}set documentPermanent(t){this.metadata.documentSizes=t}updateDocument(t,e,r=!1){var a=-1===this.keys.indexOf(t),s=e-(this.documentSizes[t]||0);a=a?1:0;this.documentSizes[t]=e,this.documentModifiedAt[t]=Date.now(),this.documentPermanent[t]=r?1:0,this.metadata.sizeKB+=s,this.metadata.length+=a,this.metadata.modifiedAt=Date.now(),this.databaseMetadata.adjustTotals(s,a)}deleteDocument(t){var e;return-1!==this.keys.indexOf(t)&&(e=-this.documentSizes[t],delete this.documentSizes[t],delete this.documentModifiedAt[t],delete this.documentPermanent[t],this.metadata.sizeKB+=e,this.metadata.length+=-1,this.metadata.modifiedAt=Date.now(),this.databaseMetadata.adjustTotals(e,-1),!0)}updateDocuments(t){for(var{docId:e,docSizeKB:r,isPermanent:a}of t)this.updateDocument(e,r,a)}deleteDocuments(t){for(var e of t)this.deleteDocument(e)}getRawMetadata(){return this.metadata}setRawMetadata(t){this.metadata=t}}class u{constructor(t,e=null){this._id=t._id||this._generateId(),this._created=t._created||Date.now(),this._permanent=!!t._permanent,this._encrypted=t._encrypted||!!e,this._compressed=t._compressed||!1,t.packedData?(this._packedData=t.packedData,this._modified=t._modified||Date.now(),this._data=null):(this._data=t.data||{},this._modified=Date.now(),this._packedData=new Uint8Array(0)),this._encryptionKey=e||""}get data(){return this._data}get packedData(){return this._packedData}get encryptionKey(){return this._encryptionKey}set data(t){this._data=t}set packedData(t){this._packedData=t}set encryptionKey(t){this._encryptionKey=t}static isEncrypted(t){return t._encrypted&&t.packedData}static async decryptDocument(t,r){if(u.isEncrypted(t))return r=await n.decrypt(t.packedData,r),r=e.a.unpack(r),{_id:t._id,_created:t._created,_modified:t._modified,_encrypted:!0,_compressed:t._compressed,_permanent:!!t._permanent,data:r};throw new Error("Document is not encrypted.")}async pack(){if(!this.data)throw new Error("No data to pack");let t=e.a.pack(this.data);return this._compressed&&(t=await this._compressData(t)),this._encrypted&&(t=await this._encryptData(t)),this.packedData=t}async unpack(){if(!this.data&&0<this.packedData.length){let t=this.packedData;this._encrypted&&(t=await this._decryptData(t)),this._compressed&&(t=await this._decompressData(t)),this.data=e.a.unpack(t)}return this.data}async _encryptData(t){var e=this.encryptionKey;return n.encrypt(t,e)}async _decryptData(t){var e=this.encryptionKey;return n.decrypt(t,e)}async _compressData(t){return i.compress(t)}async _decompressData(t){return i.decompress(t)}_generateId(){return"xxxx-xxxx-xxxx".replace(/[x]/g,()=>(16*Math.random()|0).toString(16))}async objectOutput(){return this.data||await this.unpack(),{_id:this._id,_created:this._created,_modified:this._modified,_permanent:!!this._permanent,_encrypted:this._encrypted,_compressed:this._compressed,data:this.data}}async databaseOutput(){return this.packedData&&0!==this.packedData.length||await this.pack(),{_id:this._id,_created:this._created,_modified:this._modified,_permanent:!!this._permanent,_compressed:this._compressed,_encrypted:this._encrypted,packedData:this.packedData}}}class l{constructor(t,e={}){this._dbName=t,this._settingsKey=`lacertadb_${this._dbName}_settings`,this._settings=this._loadSettings(),this._mergeSettings(e)}_loadSettings(){return c.getItem(this.settingsKey)||{}}_saveSettings(){c.setItem(this.settingsKey,this.settings)}_mergeSettings(t){this.settings=s(s({},this.settings),t),this._saveSettings()}get(t){return this.settings[t]}set(t,e){this.settings[t]=e,this._saveSettings()}remove(t){delete this.settings[t],this._saveSettings()}clear(){this.settings={},this._saveSettings()}get dbName(){return this._dbName}get settings(){return this._settings}set settings(t){this._settings=t}get settingsKey(){return this._settings}}class _{constructor(t,e,r={}){this._database=t,this._collectionName=e,this._settings=r,this._metadata=null,this._lastFreeSpaceTime=0}async init(){if(this.settings.sizeLimitKB=this.settings.sizeLimitKB||1/0,this.settings.bufferLimitKB=this.settings.bufferLimitKB||.2*this.settings.sizeLimitKB,this.settings.bufferLimitKB<-.8*this.settings.sizeLimitKB)throw new Error("Buffer limit cannot be below -80% of the size limit.");this.settings.freeSpaceEvery=this._validateFreeSpaceSetting(this.settings.freeSpaceEvery),this.metadata=this.database.metadata.getCollectionMetadata(this.name)}_validateFreeSpaceSetting(t){if(void 0===t||!1===t||0===t)return 1/0;if(t<1e3&&0!==t)throw new Error("Invalid freeSpaceEvery value. It must be 0, Infinity, or above 1000.");return 1e3<=t&&t<1e4&&console.warn("Warning: freeSpaceEvery value is between 1000 and 10000, which may lead to frequent freeing."),t}get name(){return this._collectionName}get keys(){return Object.keys(this.metadata.documentSizes||{})}get settings(){return this._settings}set settings(t){this._settings=t}get lastFreeSpaceTime(){return this._lastFreeSpaceTime}set lastFreeSpaceTime(t){this._lastFreeSpaceTime=t}get database(){return this._database}get metadata(){return this._metadata}set metadata(t){this._metadata=t}get sizeKB(){return this.metadata.sizeKB}get length(){return this.metadata.length}get totalSizeKB(){return this.sizeKB}get totalLength(){return this.length}get modifiedAt(){return this.metadata.modifiedAt}get isFreeSpaceEnabled(){return this.settings.freeSpaceEvery!==1/0}get shouldRunFreeSpaceSize(){return this.totalSizeKB>this.settings.sizeLimitKB+this.settings.bufferLimitKB}get shouldRunFreeSpaceTime(){return this.isFreeSpaceEnabled&&Date.now()-this.lastFreeSpaceTime>=this.settings.freeSpaceEvery}async _maybeFreeSpace(){if(this.shouldRunFreeSpaceSize||this.shouldRunFreeSpaceTime)return this.freeSpace(this.settings.sizeLimitKB)}async addDocument(t,e=null){let r=await new u(t,e).databaseOutput();t=r._id,e=r._permanent||!1;let a=!(t in this.metadata.documentSizes);try{a?await o.performTransaction(this.database.db,this.name,"readwrite",t=>o.add(t,r)):await o.performTransaction(this.database.db,this.name,"readwrite",t=>o.put(t,r))}catch(t){if(!a)throw t;await o.performTransaction(this.database.db,this.name,"readwrite",t=>o.put(t,r)),a=!1}var s=r.packedData.byteLength/1024;return this.metadata.updateDocument(t,s,e),this.database.metadata.saveMetadata(),await this._maybeFreeSpace(),a}async getDocument(t,e=null){if(t in this.metadata.data.documentSizes){var r=await o.performTransaction(this.database.db,this.name,"readonly",e=>o.get(e,t));if(r){let t;if(u.isEncrypted(r)){if(!e)return!1;t=new u(r,e)}else t=new u(r);return t.objectOutput()}}return!1}async getDocuments(t,e=null){var r=[];let a=t.filter(t=>t in this.metadata.data.documentSizes);if(0!==a.length){var s;t=await o.performTransaction(this.database.db,this.name,"readonly",async t=>a.map(e=>o.get(t,e)));for(s of await Promise.all(t))if(s){let t;if(u.isEncrypted(s)){if(!e)continue;t=new u(s,e)}else t=new u(s);var i=await t.objectOutput();r.push(i)}}return r}async deleteDocument(t,e=!1){return!(this.metadata.data.documentPermanent[t]&&!e)&&t in this.metadata.data.documentSizes&&(await o.performTransaction(this.database.db,this.name,"readwrite",e=>o.delete(e,t)),this.metadata.deleteDocument(t),this.database.metadata.saveMetadata(),!0)}async deleteDocuments(t,e=!1){let r=t.filter(t=>{var r=t in this.metadata.data.documentSizes;t=this.metadata.data.documentPermanent[t]||!1;return r&&(e||!t)});return 0===r.length?0:(t=r.reduce((t,e)=>t+this.metadata._metadata.documentSizes[e],0),await o.performTransaction(this.database.db,this.name,"readwrite",async t=>{for(var e of r)t.delete(e)}),this.metadata.deleteDocuments(r),this.database.metadata.saveMetadata(),t)}async freeSpace(t){let e;if(this.lastFreeSpaceTime=Date.now(),0<=t){var r=this.metadata.sizeKB;if(r<=t)return 0;e=r-t}else e=-t;let a=0;var s,i=[];for([s]of Object.entries(this.metadata.data.documentModifiedAt).filter(([t])=>!this.metadata.data.documentPermanent[t]).sort((t,e)=>t[1]-e[1])){if(a+=this.metadata.data.documentSizes[s],i.push(s),a>=e)break}return await this.deleteDocuments(i)}async query(t={},e=null){let r=[];return await o.performTransaction(this.database.db,this.name,"readonly",async a=>{await o.iterateCursor(a,async a=>{let s;if(u.isEncrypted(a)){if(!e)return;s=new u(a,e)}else s=new u(a);let i=!0;var n,o=Object.keys(t).length?await s.objectOutput():null;for(n in t)if(o.data[n]!==t[n]){i=!1;break}i&&r.push(o||await s.objectOutput())})}),r}}var m={Database:class{constructor(t){this._dbName=t,this._db=null,this._collections=new Map,this._metadata=new h(t),this._settings=new l(t)}async init(){var t;for(t of(this.db=await o.openDatabase(this.name,void 0,(t,e,r)=>{this._upgradeDatabase(t,e,r)}),this.data.getCollectionNames())){var e=new _(this,t);await e.init(),this.collections.set(t,e)}}_createDataStores(t){for(var e of this.collections.keys())this._createDataStore(t,e)}_createDataStore(t,e){t.objectStoreNames.contains(e)||t.createObjectStore(e,{keyPath:"_id"})}_upgradeDatabase(t,e,r){console.log(`Upgrading database "${this.name}" from version ${e} to `+r),this._createDataStores(t)}async createCollection(t,e={}){var r;return this.collections.has(t)?(console.log(`Collection "${t}" already exists.`),this.collections.get(t)):(this.db.objectStoreNames.contains(t)||(r=this.db.version+1,this.db.close(),this.db=await o.openDatabase(this.name,r,(e,r,a)=>{this._createDataStore(e,t)})),await(r=new _(this,t,e)).init(),this.collections.set(t,r),this.data.getCollectionMetadata(t),this.data.saveMetadata(),r)}async deleteCollection(t){if(!this.collections.has(t))throw new Error(`Collection "${t}" does not exist.`);await o.performTransaction(this.db,t,"readwrite",t=>o.clear(t)),this.collections.delete(t),this.data.removeCollectionMetadata(t),this.data.saveMetadata()}async getCollection(t){if(this.collections.has(t))return this.collections.get(t);var e;if(this.db.objectStoreNames.contains(t))return await(e=new _(this,t)).init(),this.collections.set(t,e),e;throw new Error(`Collection "${t}" does not exist.`)}async close(){this.db&&(this.db.close(),this.db=null)}async deleteDatabase(){await this.close(),await o.deleteDatabase(this.name),this.data=null,this.settings.clear(),c.removeItem(this.data.metadataKey)}get name(){return this._dbName}get db(){return this._db}set db(t){this._db=t}get data(){return this.metadata}set data(t){this.metadata=t}get collectionsArray(){return Array.from(this.collections.values())}get collections(){return this._collections}get metadata(){return this._metadata}set metadata(t){this._metadata=t}get totalSizeKB(){return this.data.totalSizeKB}get totalLength(){return this.data.totalLength}get modifiedAt(){return this.data.modifiedAt}get settings(){return this._settings}},Document:u};t.exports={LacertaDB:m}}.call(this,r(3)(t))},function(t,e){t.exports=function(t){var e;return t.webpackPolyfill||((e=Object.create(t)).children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1),e}}]);